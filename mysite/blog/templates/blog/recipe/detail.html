{% extends "blog/recipe_base.html" %}
{% load recipe_tags %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
    <h1>{{ recipe.title }}</h1>
    <p class="date">
        Published {{ recipe.publish }} by {{ recipe.author }}
    </p>
    {{ recipe.body|markdown }}
    <p>
        <a href="{% url "blog:recipe_share" recipe.id %}">
            Share this recipe
        </a>
    </p>

    <!-- Display Recipe Rating (average rating) -->
    <div class="rating-section">
        <h2>Rating</h2>
        <div class="average-rating">
            {% if average_rating %}
                <strong>Average Rating: </strong>
                {{ average_rating|floatformat:1 }} out of 5 stars
                <!-- Display average rating as stars -->
                <div class="star-rating">
                    {% for i in "12345" %}
                        {% if i <= average_rating|stringformat:"0" %}
                            <span class="fa fa-star checked"></span>
                        {% else %}
                            <span class="fa fa-star"></span>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <p>No ratings yet.</p>
            {% endif %}
        </div>

        <!-- Rating Form -->
        <div class="rating-form">
            {% include "blog/recipe/includes/rating_form.html" %}
        </div>
    </div>

    <!-- Similar Recipes Section -->
    <div class="similar-recipes">
        <h2>Similar recipes</h2>
        {% for recipe in similar_recipes %}
            <p>
                <a href="{{ recipe.get_absolute_url }}">{{ recipe.title }}</a>
            </p>
        {% empty %}
            <p>There are no similar recipes yet.</p>
        {% endfor %}
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
        {% with comments.count as total_comments %}
            <h2>{{ total_comments }} comment{{ total_comments|pluralize }}</h2>
        {% endwith %}
        {% for comment in comments %}
            <div class="comment">
                <p class="info">
                    Comment {{ forloop.counter }} by {{ comment.name }} on {{ comment.created }}
                </p>
                {{ comment.body|linebreaks }}
            </div>
        {% empty %}
            <p>There are no comments.</p>
        {% endfor %}
        
        <!-- Comment Form -->
        <div class="comment-form">
            {% include "blog/recipe/includes/comment_form.html" %}
        </div>
    </div>
{% endblock %}
